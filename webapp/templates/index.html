<!DOCTYPE html>
<html lang="en">

<head>
  <title>Kadist Index Search</title>

  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <link rel="stylesheet" media="screen" href="{{ url_for('static', filename='css/main.css') }}">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}" />

  <meta name="apple-mobile-web-app-capable" content="yes">


  <script>
    function formatFacet(s) {
      return s.replace('_', ' ').replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
    }
    function formatTag(s) {
      return s.split('.')[0].replace('_', ' ');
    }
  </script>

</head>

<body class="body">

  <!-- Fixed navbar -->
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Kadist Index</a>
      </div>

        <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="http://www.kapsul.org" target="_blank">Kapsul.org</a></li>
          <li><a href="http://www.kadist.org" target="_blank">Kadist.org</a></li>
        </ul>
      </div><!--/.navbar-collapse -->
    </div> <!-- container-fluid -->
  </nav>

  <div class="container-fluid">

    <div class="row">

      {% if results['facets'] %}
        <div class="col-sm-4 col-md-3 sidebar ">
          {% for facet in results['facets'] %}
            <h3><span class="label label-default"><script>document.write(formatFacet('{{facet}}'))</script>:</span></h3>
            <ul class="nav nav-sidebar">
              {% for f in results['facets'][facet] %}
                <li><a href="/?q={{q}}&filter_field={{facet}}&filter_value={{f['key']}}">{{f['key']}} ({{f['doc_count']}})</a></li>
              {% endfor %}
              {% if results['filter'] %}
                <li><a href="/?q={{q}}"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a></li>
                {% endif %}
            </ul>
          {% endfor %}
        </div>
      {% endif %}

      <div class="col-sm-8 col-sm-offset-4 col-md-9 col-md-offset-3">

        <!-- Search & results count Bar -->
        <div>
          {% if not q %}
            <div class="panel">
              <h1><img src="{{ url_for('static', filename='images/kadist_logo.png') }}" class="thumbnail">Welcome to Kadist Art Discovery</h1>
                <p>Kadist's collections and productions reflect the global scope of contemporary
                art, and its programs develop collaborations with like-minded artists, curators and many art
                organizations around the world. Local programs in Kadist's hubs of Paris and San Francisco,
                including exhibitions, public events, residencies and educational initiatives, aim at creating
                vibrant conversations about contemporary art and ideas.</p>
            </div>
          {% endif %}

          <form role="search" method="get" class="search-form">
            <div class="input-group full-width">
              <input type="search" name="q" id="q" value="{% if q %}{{q}}{% endif %}" autocomplete="off" autocapitalize="off"
                autocorrect="off" class="search-field form-control" placeholder="Search">
              <span class="input-group-btn">
                <button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
              </span>
            </div>
          </form>

          {% if q %}
            <p class="search-result-header">
                {{results['count']}} results
                {% if results['filter'] %}
                  ({{results['filter'][0]}}:&nbsp;"{{results['filter'][1]}}")
                {% endif %}
                &nbsp;({{results['took']}} seconds)
            </p>
          {% endif %}
        </div>
        <!-- End Search & results count Bar -->


        <!-- Search Results -->
        {% if results['hits'] %}
          <article>
            <div id="columns">
                {% for hit in results['hits'] %}
                  {% if hit['imgurl'] %}
                    <div class="pin">
                      <img class="img" src="{{hit['imgurl']}}">
                      <center>
                        <h4>{{hit['title']}}</h4>
                        <p><a href="/?q={{hit['artist_name']}}">{{hit['artist_name']}}</a>{% if hit['year'] %}, <a href="/?q={{hit['year']}}">{{hit['year']}}</a>{% endif %}
                        <a href="/?q=_{{hit['id']}}" title="More like this..."><span class="glyphicon glyphicon glyphicon-duplicate" aria-hidden="true"></span></a>
                        </p>
                      </center>
                        <div class="details">
                        <hr/>
                        {% if hit['description'] %}
                          <h4><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span>&nbsp;Works Description</h4>
                          <p>
                            {% if hit['worktype'] %}
                              <a href="/?q={{hit['worktype']}}"><h5>{{hit['worktype']}}</h5></a>
                            {% endif %}
                            {{hit['description']}}
                          </p>
                        {% endif %}

                        {% if hit['artist_name'] and hit['artist_description'] %}
                          <a href="/?q={{hit['artist_name']}}"><h4><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span>&nbsp;{{hit['artist_name']}}</h4></a>
                          <p>
                            {{hit['artist_description']}}
                          </p>
                        {% endif %}

                        {% if hit['major_tags'] or hit['minor_tags'] %}
                          <h4><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span>&nbsp;Tags</h4>
                          {% for tag in hit['major_tags'] %}
                            <a href="/?q={{tag}}"><span class="label label-primary tags"><script>document.write(formatTag('{{tag}}'))</script></span></a>
                          {% endfor %}

                          {% for tag in hit['minor_tags'] %}
                            <a href="/?q={{tag}}"><span class="label label-info tags"><script>document.write(formatTag('{{tag}}'))</script></span></a>
                          {% endfor %}
                        {% endif %}
                      </div>
                    </div>
                  {% endif %}
                {% endfor %}
              </div> <!-- columns -->
          </article>
        {% endif %}
        <!-- Search Results -->

      </div> <!-- main -->
    </div> <!-- row -->
  </div> <!-- container -->


  <script src="//code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

  <script src="{{ url_for('static', filename='js/masonry.pkgd.min.js') }}" type="text/javascript"></script>
  <script src="{{ url_for('static', filename='js/imagesloaded.pkgd.min.js') }}" type="text/javascript"></script>

  <script>



    $( document ).ready(function() {

      $("#q").focus();
      $("#q").select();

      $('#columns').masonry({
        columnWidth: 235,
        gutter: 20,
        itemSelector: '.pin'
      });

      $('#columns').imagesLoaded(function() {
        $('#columns').masonry('layout');
      });

      $(".pin").on('click', function() {

          var el = $(this);

          $(this).find(".details").slideToggle('fast', function(deets) {
            if($(this).is(':hidden')) {
              el.removeClass("resize")
            } else {
              if($('#columns').width() > 500) {
                el.addClass("resize");
              }

              $('html, body').animate({
                scrollTop: el.offset().top - 20
              }, 'slow');
            }
            $('.pin').not(el).removeClass("resize").find('.details').hide("fast");
            $('#columns').masonry('layout');
          });

      });
    });
  </script>

  </body>
  </html>
