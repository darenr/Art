<!DOCTYPE html>
<html lang="en">

<head>
  <title>Kadist Index Search</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <link rel="stylesheet" media="screen" href="{{ url_for('static', filename='css/main.css') }}">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

   <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}" />
</head>

<body class="body">

  <!-- Fixed navbar -->
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Kadist Index</a>
      </div>

        <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="http://www.kapsul.org">Kapsul.org</a></li>
          <li><a href="http://www.kadist.org">Kadist.org</a></li>
        </ul>
      </div><!--/.navbar-collapse -->
    </div> <!-- container-fluid -->
  </nav>

  <div class="container-fluid">

    <div class="row">

      {% if results['facets'] %}
        <div class="col-sm-3 col-md-2 sidebar ">
          {% for facet in results['facets'] %}
            <h3><span class="label label-success">{{facet}}:</span></h3>
            <ul class="nav nav-sidebar">
              {% for f in results['facets'][facet] %}
                <li><a href="/?q={{q}}&filter_field={{facet}}&filter_value={{f['key']}}">{{f['key']}} ({{f['doc_count']}})</a></li>
              {% endfor %}
              {% if results['filter'] %}
                <li><a href="/?q={{q}}"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a></li>
              {% endif %}
            </ul>
          {% endfor %}
        </div>
      {% endif %}

      <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2">

        <!-- Search & results count Bar -->
        <div>
          {% if not q %}
            <div class="panel">
              <h1><img src="{{ url_for('static', filename='images/kadist_logo.png') }}" class="thumbnail">Welcome to Kadist Art Discovery</h1>
                <p>Kadist's collections and productions reflect the global scope of contemporary
                art, and its programs develop collaborations with like-minded artists, curators and many art
                organizations around the world. Local programs in Kadist's hubs of Paris and San Francisco,
                including exhibitions, public events, residencies and educational initiatives, aim at creating
                vibrant conversations about contemporary art and ideas.</p>
            </div>
          {% endif %}

          <form role="search" method="get" class="search-form">
            <div class="input-group full-width">
              <input type="search" name="q" id="q" value="{% if q %}{{q}}{% endif %}" autocomplete="off" class="search-field form-control" placeholder="Search">
              <span class="input-group-btn">
                <button class="btn btn-default" type="button"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
              </span>
            </div>
          </form>

          {% if q %}
            <p class="search-result-header">{{results['count']}} results ({{results['took']}} seconds)
              {% if results['filter'] %}
                ({{results['filter'][0]}}:&nbsp;"{{results['filter'][1]}}")
              {% endif %}
            </p>
          {% endif %}
        </div>
        <!-- End Search & results count Bar -->


        <!-- Search Results -->
        {% if results['hits'] %}
          <article>
            {% if results['list_layout'] %}
              {% for hit in results['hits'] %}
                <div class="panel panel-default">
                  <div class="panel-body">
                    <div class="col-sm-8">
                      {% if hit['imgurl'] %}
                        <h2>{{hit['title']}}</h2>
                        <div class="thumbnail">
                          <img class="img" alt="{{hit['artist_name']}}{% if hit['year'] %}, {{hit['year']}}{% endif %}, {{hit['worktype']}}" width="100%" src="{{hit['imgurl']}}">
                          <div class="caption">
                            <center>
                            {{hit['artist_name']}}{% if hit['year'] %}, {{hit['year']}}{% endif %}, {{hit['worktype']}}
                            <a href="/?q=_{{hit['id']}}" title="More like this..."><span class="glyphicon glyphicon glyphicon-duplicate" aria-hidden="true"></span></a>
                            </center>
                          </div>
                        </div>
                      {% endif %}
                      {% if hit['description'] %}
                        <p>
                          <br/><small>{{hit['description']}}</small>
                        </p>
                      {% endif %}

                      {% if hit['major_tags'] %}
                        {% for tag in hit['major_tags'] %}
                          <a href="/?q={{tag}}"><span class="label label-primary tags">{{tag}}</span></a>
                        {% endfor %}
                        <br/>
                      {% endif %}
                      {% if hit['minor_tags'] %}
                        {% for tag in hit['minor_tags'] %}
                          <a href="/?q={{tag}}"><span class="label label-info tags">{{tag}}</span></a>
                        {% endfor %}
                      {% endif %}
                    </div> <!-- works column -->

                    <div class="col-sm-4 pull-left">
                     <h2>{{hit['artist_name']}}</h2>
                      {% if hit['artist_description'] %}
                        <p> {{hit['artist_description']}}</p>
                      {% endif %}
                    </div> <!-- artist column -->

                  </div> <!-- panel body -->
                </div> <!-- panel -->
              {% endfor %}
            {% else %} <!-- else list_layout -->
              <div id="columns">
                  {% for hit in results['hits'] %}
                    {% if hit['imgurl'] %}
                      <div class="pin">
                        <img class="img" src="{{hit['imgurl']}}">
                        <center>
                          <h4>{{hit['title']}}</h4>
                          <p><a href="/?q={{hit['artist_name']}}">{{hit['artist_name']}}</a>{% if hit['year'] %}, <a href="/?q={{hit['year']}}">{{hit['year']}}</a>{% endif %}
                          <a href="/?q=_{{hit['id']}}" title="More like this..."><span class="glyphicon glyphicon glyphicon-duplicate" aria-hidden="true"></span></a>
                          </p>
                        </center>
                        <div class="details">
                          <hr/>
                          {% if hit['description'] %}
                            <h4>Works Description</h4>
                            <p>
                              {% if hit['worktype'] %}
                                <h5>{{hit['worktype']}}</h5>
                              {% endif %}
                              {{hit['description']}}
                            </p>
                          {% endif %}

                          {% if hit['artist_name'] and hit['artist_description'] %}
                            <a href="/?q={{hit['artist_name']}}"><h4>{{hit['artist_name']}}</h4></a>
                            <p>
                              {{hit['artist_description']}}
                            </p>
                          {% endif %}

                          {% if hit['major_tags'] %}
                            <h4>Tags</h4>
                            {% for tag in hit['major_tags'] %}
                              <a href="/?q={{tag}}"><span class="label label-primary tags">{{tag}}</span></a>
                            {% endfor %}

                            {% for tag in hit['minor_tags'] %}
                              <a href="/?q={{tag}}"><span class="label label-info tags">{{tag}}</span></a>
                            {% endfor %}
                          {% endif %}
                        </div>
                      </div>
                    {% endif %}
                  {% endfor %}
                </div>
            {% endif %} <!-- list_layout -->
          </article>
        {% endif %}
        <!-- Search Results -->


      </div> <!-- main -->
    </div> <!-- row -->
  </div> <!-- container -->


  <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

  <script src="{{ url_for('static', filename='js/masonry.pkgd.min.js') }}" type="text/javascript"></script>
  <script src="{{ url_for('static', filename='js/imagesloaded.pkgd.min.js') }}" type="text/javascript"></script>

  <script>
    $( document ).ready(function() {

      $("#q").focus();
      $("#q").select();

      $('#columns').masonry({
        columnWidth: 125,
        "gutter": 10,
        itemSelector: '.pin'
      });

      $('#columns').imagesLoaded(function() {
        $('#columns').masonry('layout');
      });

      $(".pin").on('click', function() {
          var state = $(this).data('state');
          if ( state ) {
            $(this).removeClass("resize")
            $(this).find(".details").slideToggle('fast', function() {
              $('#columns').masonry();
            });
            state = false;
          }else{
            $(this).addClass("resize")
            $(this).find(".details").slideToggle('fast', function() {
              $('#columns').masonry();
            });
            state = true;
          }
          $(this).data('state', state);
      });
    });
  </script>

  </body>
  </html>
